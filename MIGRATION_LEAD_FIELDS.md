# Миграция: Добавление полей stage и lastAction в модель Lead

## Изменения в схеме

В модель `Lead` добавлены два новых поля:
- `stage` (String, default: "Первый контакт") - этап работы с лидом
- `lastAction` (DateTime?, optional) - дата последнего действия с лидом

## Выполнение миграции

1. Создайте миграцию:
```bash
cd server
npx prisma migrate dev --name add_lead_stage_and_last_action
```

2. Или примените изменения напрямую к схеме:
```bash
cd server
npx prisma db push
```

3. Перегенерируйте Prisma Client:
```bash
npx prisma generate
```

## Что было исправлено

1. ✅ Добавлены поля `stage` и `lastAction` в схему Prisma
2. ✅ Обновлен контроллер для обработки этих полей при создании и обновлении лидов
3. ✅ При изменении статуса лида автоматически обновляется `lastAction`
4. ✅ При создании лида устанавливается `lastAction` на текущую дату
5. ✅ Добавлена валидация email на клиенте и сервере

## Проверка

После миграции убедитесь, что:
- Карточки лидов отображают поле "Этап" и "Последнее действие"
- При изменении статуса обновляется "Последнее действие"
- Email валидируется корректно (не допускаются адреса с двойными точками и т.д.)

