# Настройка секретов и API ключей

## Безопасное хранение секретов

Система поддерживает несколько способов передачи секретов:

### 1. Через файл .env (рекомендуется для разработки)

Создайте или отредактируйте файл `server/.env`:

```env
# OpenAI API
OPENAI_API_KEY=sk-your-api-key-here

# Или альтернативное имя
OPENAI_SECRET=sk-your-api-key-here
```

**Важно:** Файл `.env` уже добавлен в `.gitignore` и не будет закоммичен в git.

### 2. Через системные переменные окружения (рекомендуется для продакшена)

Установите переменную окружения в системе:

**macOS/Linux:**
```bash
export OPENAI_API_KEY=sk-your-api-key-here
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (CMD):**
```cmd
set OPENAI_API_KEY=sk-your-api-key-here
```

### 3. Через .env.local (альтернатива)

Создайте файл `server/.env.local` (он также игнорируется git):

```env
OPENAI_API_KEY=sk-your-api-key-here
```

## Приоритет загрузки

Система загружает секреты в следующем порядке приоритета:

1. **Системные переменные окружения** (наивысший приоритет)
2. **Файл .env**
3. **Файл .env.local** (если используется dotenv с расширенной конфигурацией)

Это означает, что системные переменные окружения переопределят значения из .env файла.

## Проверка статуса

После настройки вы можете проверить статус OpenAI API:

```bash
curl http://localhost:3001/api/ai/status
```

Ответ:
```json
{
  "available": true,
  "configured": true,
  "message": "OpenAI API настроен и готов к использованию"
}
```

## Безопасность

### ✅ Что делать:

- Храните `.env` файл локально
- Используйте системные переменные окружения в продакшене
- Регулярно ротируйте API ключи
- Используйте разные ключи для разработки и продакшена

### ❌ Что НЕ делать:

- НЕ коммитьте `.env` файл в git (уже в .gitignore)
- НЕ делитесь API ключами публично
- НЕ храните ключи в коде
- НЕ используйте один ключ для всех окружений

## Примеры для разных окружений

### Разработка (локально)
```env
# server/.env
OPENAI_API_KEY=sk-dev-key-here
```

### Продакшен (через переменные окружения)
```bash
# Установите в системе перед запуском
export OPENAI_API_KEY=sk-prod-key-here
npm start
```

### Docker
```yaml
# docker-compose.yml
services:
  server:
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
```

Или через `.env` файл:
```env
OPENAI_API_KEY=sk-your-key-here
```

## Fallback режим

Если API ключ не настроен, система автоматически переключается на fallback режим:
- Использует встроенную логику для генерации текстов
- Работает без внешних зависимостей
- Функциональность сохраняется, но без GPT

## Получение OpenAI API ключа

1. Зайдите на [platform.openai.com](https://platform.openai.com)
2. Перейдите в **API keys**
3. Нажмите **Create new secret key**
4. Скопируйте ключ (показывается только один раз!)

## Проверка работы

После настройки при создании кампании:
- Тексты будут генерироваться через GPT (если ключ настроен)
- В ответе API будет поле `aiPowered: true`
- Рекомендации будут более персонализированными

